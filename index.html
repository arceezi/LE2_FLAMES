<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FLAMES</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <header class="site-header">
    <div class="nav-wrap">
      <div class="logo" aria-label="Flames">FLAMES</div>
      <nav class="nav">
        <a href="#home">Home</a>
        <a href="#about">About</a>
        <a href="#calculator">Calculator</a>
        <a href="#contact">Contact</a>
      </nav>
    </div>
  </header>

  <main id="home" class="page">
    <section class="hero" aria-hidden="true"></section>

    <section id="calculator" class="form-section">
      <div class="form-card">
        <h1 class="form-title">Calculate Compatibility</h1>
        <p class="form-subtitle">Enter both names and birthdays to reveal zodiac signs and FLAMES result.</p>

        <div id="errors" class="alert alert-error" hidden></div>

        <form id="flames-form" class="form">
          <div class="field-grid">
            <div class="field">
              <label for="name1">Your Name</label>
              <input type="text" id="name1" name="name1" placeholder="Your Name" required />
            </div>

            <div class="field">
              <label for="name2">Partner's Name</label>
              <input type="text" id="name2" name="name2" placeholder="Partner's Name" required />
            </div>

            <div class="field">
              <label for="bday1">Your Birthday</label>
              <input type="date" id="bday1" name="bday1" required />
            </div>

            <div class="field">
              <label for="bday2">Partner's Birthday</label>
              <input type="date" id="bday2" name="bday2" required />
            </div>
          </div>

          <button class="cta" type="submit">Calculate Compatibility</button>
        </form>
      </div>
    </section>

    <section class="output" aria-live="polite">
      <div id="output" class="output-card">
        <p class="empty">No result yet. Fill out the form above and click <b>Calculate Compatibility</b>.</p>
      </div>
    </section>
  </main>

  <footer id="contact" class="site-footer">
    <div class="socials" aria-label="Social links">
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
      <span class="dot"></span>
    </div>
    <p>Copyright Â© FLAMES. All rights reserved.</p>
  </footer>

  <script>
    const endpoint = 'LE2_ZabalaRC.php';

    async function postForm(formData) {
      const res = await fetch(endpoint, {
        method: 'POST',
        body: formData,
      });
      return res.json();
    }

    function renderResult(data) {
      const out = document.getElementById('output');
      const errorsBox = document.getElementById('errors');
      if (data.errors && data.errors.length) {
        errorsBox.hidden = false;
        errorsBox.innerHTML = '<ul>' + data.errors.map(e => '<li>' + e + '</li>').join('') + '</ul>';
        out.innerHTML = '';
        return;
      }

      errorsBox.hidden = true;
      const r = data.result;
      if (!r) {
        out.innerHTML = '<p class="empty">No result returned.</p>';
        return;
      }

      const f = r.flames;
      const commonList = (f.commonLetters && f.commonLetters.length) ? f.commonLetters.join(', ') : 'None';

      out.innerHTML = `
        <div class="result-grid">
          <div class="result-box">
            <h3>${escapeHtml(r.name1)}</h3>
            <p><b>Birthday:</b> ${escapeHtml(r.bday1)}</p>
            <p><b>Zodiac:</b> ${escapeHtml(r.zodiac1)}</p>
          </div>

          <div class="result-box">
            <h3>${escapeHtml(r.name2)}</h3>
            <p><b>Birthday:</b> ${escapeHtml(r.bday2)}</p>
            <p><b>Zodiac:</b> ${escapeHtml(r.zodiac2)}</p>
          </div>
        </div>

        <div class="compatibility">
          <h3 class="compat-title">Compatibility Result</h3>
          <p class="compat-text">${escapeHtml(r.name1)} and ${escapeHtml(r.name2)} are <b>${escapeHtml(f.flamesMeaning)}</b>.</p>

          <div class="details">
            <h4>Computation Details</h4>
            <ul>
              <li><b>Common letters:</b> ${escapeHtml(commonList)}</li>
              <li><b>${escapeHtml(r.name1)}</b> common-letter count: ${Number(f.count1)}</li>
              <li><b>${escapeHtml(r.name2)}</b> common-letter count: ${Number(f.count2)}</li>
              <li><b>Total:</b> ${Number(f.total)}</li>
              <li><b>Total mod 6:</b> ${Number(f.remainder)}</li>
              <li><b>FLAMES letter:</b> ${escapeHtml(f.flamesLetter)}</li>
            </ul>
            <p class="note">Mapping: F = Friends, L = Lovers, A = Anger, M = Married, E = Engaged, S = Soulmates</p>
          </div>
        </div>
      `;
    }

    function escapeHtml(s) {
      if (!s && s !== 0) return '';
      return String(s).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
    }

    document.getElementById('flames-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const fd = new FormData(form);
      const json = await postForm(fd);
      renderResult(json);
    });
  </script>
</body>
</html>
